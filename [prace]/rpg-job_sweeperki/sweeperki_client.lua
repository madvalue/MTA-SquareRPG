--[[
	Praca czyszczenia ulic
	@author value <value2k@gmail.com>
	Nie masz prawa użyć tego kodu bez mojej zgody
]]
local trasa = 1
local punkt = 1
local region = 1
local perpunkt = 0.6

local punkty = {
	[1] = { -- San Fierro
		[1] = {
				{-1948.14380, 1313.26526, 7.00966},
				{-1956.09827, 1313.15613, 7.00961},
				{-1962.21301, 1313.07239, 7.00961},
				{-1967.94177, 1313.31128, 7.00962},
				{-1973.52283, 1313.61292, 7.00963},
				{-1978.89246, 1313.75232, 7.00967},
				{-1984.59473, 1313.66809, 7.00964},
				{-1989.92896, 1313.94250, 7.00961},
				{-1995.87024, 1313.82312, 7.00962},
				{-2000.68311, 1314.01062, 7.00964},
				{-2005.78210, 1314.14465, 7.00965},
			},
		[2] = {
			{-2238.48193, 1171.19946, 55.63186},
			{-2230.87134, 1171.17493, 55.54883},
			{-2223.50244, 1171.15100, 55.54898},
			{-2214.63159, 1171.11646, 55.54867},
			{-2205.63159, 1171.13354, 55.54870},
			{-2198.92676, 1170.88647, 55.54871},
			{-2193.18018, 1170.78125, 55.54867},
			{-2186.61426, 1170.82898, 55.54845},
			{-2180.54224, 1170.72278, 55.54871},
			{-2174.53076, 1170.54272, 55.54869},
			{-2168.66895, 1170.36707, 55.54870},
			{-2161.72607, 1170.33044, 55.54876},
		},
		[3] = {
			{-1609.62720, 1152.10803, 7.00976},
			{-1609.47583, 1145.92603, 7.00962},
			{-1609.44458, 1140.09973, 7.00964},
			{-1609.35168, 1135.26257, 7.00963},
			{-1609.23267, 1129.73047, 7.00963},
			{-1609.22803, 1124.54785, 7.00963},
			{-1609.07874, 1120.01135, 7.00949},
			{-1609.08020, 1114.52551, 7.00963},
			{-1609.08118, 1109.60535, 7.00964},
			{-1609.23987, 1103.74280, 7.00963},
			{-1609.51758, 1098.45093, 7.00963},
			{-1609.48096, 1093.34961, 7.01624},
			{-1609.58728, 1088.10815, 7.01518},
			{-1609.46777, 1082.04773, 7.00964},
			{-1609.63806, 1077.13721, 7.00997},
			{-1609.76270, 1073.01746, 7.00963},
			{-1609.65637, 1067.42932, 7.00965},
			{-1609.55786, 1062.47192, 7.00963},
			{-1609.52783, 1058.43945, 7.00961},
			{-1609.50366, 1054.57629, 7.00963},
			{-1609.46228, 1050.28809, 7.00980},
			{-1609.41553, 1046.48938, 7.00963},
		},
		[4] = {
			{-1679.37256, 1299.08655, 7.00963},
			{-1683.63599, 1303.35510, 7.00963},
			{-1687.68213, 1307.35840, 7.01741},
			{-1691.58325, 1311.26855, 7.00967},
			{-1694.96777, 1314.72644, 7.00964},
			{-1698.67004, 1318.56396, 7.00962},
			{-1702.43640, 1322.43530, 7.00963},
			{-1705.86707, 1325.92334, 7.00963},
			{-1709.77661, 1329.93835, 7.01796},
			{-1713.21582, 1333.29309, 7.01741},
			{-1716.84729, 1336.88306, 7.00930},
			{-1720.58069, 1340.53381, 7.01584},
			{-1724.09082, 1344.00171, 7.01737},
			{-1727.71753, 1347.58179, 7.01445},
			{-1731.70972, 1351.64282, 7.00964},
		},
		[5] = {
			{-1889.72632, 1161.08350, 45.26739},
			{-1889.68958, 1156.20093, 45.26792},
			{-1889.65210, 1151.22815, 45.26745},
			{-1889.61609, 1145.11914, 45.26745},
			{-1889.63220, 1140.12451, 45.26744},
			{-1889.39294, 1134.79163, 45.26738},
			{-1889.57007, 1129.56812, 45.26745},
			{-1889.63074, 1124.78296, 45.26745},
			{-1889.52283, 1119.84766, 45.26694},
			{-1889.55029, 1114.90308, 45.26174},
			{-1889.66895, 1109.31519, 45.26744},
			{-1889.77271, 1104.42456, 45.26745},
			{-1889.85388, 1099.30396, 45.26745},
			{-1889.69678, 1093.42419, 45.26719},
		},
		[6] = {
			{-1884.33337, 913.33179, 34.97960},
			{-1879.40808, 913.34082, 34.97984},
			{-1874.41064, 913.60400, 34.97985},
			{-1869.38904, 913.61261, 34.97959},
			{-1864.63916, 913.54541, 34.97956},
			{-1859.44934, 913.58044, 34.97960},
			{-1853.49438, 913.54846, 34.96045},
			{-1847.42407, 913.51422, 33.65804},
			{-1842.97156, 913.51196, 32.26868},
			{-1838.42603, 913.31238, 30.85052},
			{-1833.88403, 913.22174, 29.43322},
			{-1828.40662, 913.11847, 27.72421},
			{-1823.32532, 912.99933, 26.13853},
			{-1818.07129, 912.83691, 24.82797},
			{-1812.76526, 912.67365, 24.71259},
			{-1808.01257, 912.53217, 24.71318},
		},
		[7] = {
			{-1779.67371, 913.52515, 24.71274},
			{-1775.57642, 913.54413, 24.70985},
			{-1770.84961, 913.56598, 24.71273},
			{-1765.77258, 913.53314, 24.71276},
			{-1761.16626, 913.54950, 24.71275},
			{-1756.33411, 913.52600, 24.71275},
			{-1751.63281, 913.44867, 24.71276},
			{-1746.77026, 913.38379, 24.71274},
			{-1742.37366, 913.32520, 24.71276},
			{-1737.96790, 913.26666, 24.71273},
			{-1733.68774, 913.20972, 24.71258},
			{-1729.55798, 913.15479, 24.71273},
		},
		[8] = {
			{-1719.76135, 904.19122, 24.71276},
			{-1719.66064, 899.17346, 24.71318},
			{-1719.56946, 893.98834, 24.71276},
			{-1719.52869, 889.13379, 24.71278},
			{-1719.51819, 884.94843, 24.71273},
			{-1719.50647, 880.60571, 24.71276},
			{-1719.49609, 876.71741, 24.71276},
			{-1719.48511, 872.43512, 24.71274},
			{-1719.47803, 867.83063, 24.71395},
			{-1719.52722, 863.74017, 24.71301},
		},
		[9] = {
			{-1719.43823, 826.62616, 24.70495},
			{-1719.43823, 822.99866, 24.70514},
			{-1719.43823, 818.67255, 24.70496},
			{-1719.43823, 814.22931, 24.70493},
			{-1719.43823, 810.38885, 24.70496},
			{-1719.43823, 806.22656, 24.70492},
			{-1719.43823, 801.77795, 24.70493},
			{-1719.43823, 797.49762, 24.70496},
			{-1719.43823, 793.63983, 24.70494},
			{-1719.43823, 789.23822, 24.70491},
			{-1719.43823, 785.31433, 24.70492},
			{-1719.43823, 780.64771, 24.70493},
			{-1719.43823, 776.64771, 24.70493},
			{-1719.43823, 772.64771, 24.70493},
			{-1719.43823, 768.64771, 24.70493},
			{-1719.43823, 764.64771, 24.70493},
			{-1719.43823, 760.64771, 24.70493},
			{-1719.43823, 756.64771, 24.70493},
			{-1719.43823, 752.64771, 24.70493},
			{-1719.43823, 748.64771, 24.70493},
			{-1719.43823, 744.64771, 24.70493},
		},
		[10] = {
			{-1708.54504, 745.60474, 24.71024},
			{-1708.54504, 749.60474, 24.71024},
			{-1708.54504, 753.60474, 24.71024},
			{-1708.54504, 757.60474, 24.71024},
			{-1708.54504, 761.60474, 24.71024},
			{-1708.54504, 765.60474, 24.71024},
			{-1708.54504, 769.60474, 24.71024},
			{-1708.54504, 773.60474, 24.71024},
			{-1708.54504, 777.60474, 24.71024},
			{-1708.54504, 781.60474, 24.71024},
			{-1708.54504, 785.60474, 24.71024},
			{-1708.54504, 789.60474, 24.71024},
			{-1708.54504, 793.60474, 24.71024},
			{-1708.54504, 797.60474, 24.71024},
			{-1708.54504, 801.60474, 24.71024},
			{-1708.54504, 805.60474, 24.71024},
			{-1708.54504, 809.60474, 24.71024},
			{-1708.54504, 813.60474, 24.71024},
			{-1708.54504, 817.60474, 24.71024},
			{-1708.54504, 821.60474, 24.71024},
			{-1708.54504, 825.60474, 24.71024},
		},
		[11] = {
			{-1708.76001, 864.45245, 24.71942},
			{-1708.76001, 868.45245, 24.71942},
			{-1708.76001, 872.45245, 24.71942},
			{-1708.76001, 876.45245, 24.71942},
			{-1708.76001, 880.45245, 24.71942},
			{-1708.76001, 884.45245, 24.71942},
			{-1708.76001, 888.45245, 24.71942},
			{-1708.76001, 892.45245, 24.71942},
			{-1708.76001, 896.45245, 24.71942},
			{-1708.76001, 900.45245, 24.71942},
			{-1708.76001, 904.45245, 24.71942},
		},
		[12] = {
			{-1799.82361, 903.90314, 24.71264},
			{-1799.82361, 899.90314, 24.71264},
			{-1799.82361, 895.90314, 24.71264},
			{-1799.82361, 891.90314, 24.71264},
			{-1799.82361, 887.90314, 24.71264},
			{-1799.82361, 883.90314, 24.71264},
			{-1799.82361, 879.90314, 24.71264},
			{-1799.82361, 875.90314, 24.71264},
			{-1799.82361, 871.90314, 24.71264},
			{-1799.82361, 867.90314, 24.71264},
			{-1799.82361, 863.90314, 24.71264},
		},
		[13] = {
			{-1788.77722, 863.90314, 24.71264},
			{-1788.77722, 867.90314, 24.71264},
			{-1788.77722, 871.90314, 24.71264},
			{-1788.77722, 875.90314, 24.71264},
			{-1788.77722, 879.90314, 24.71264},
			{-1788.77722, 883.90314, 24.71264},
			{-1788.77722, 887.90314, 24.71264},
			{-1788.77722, 891.90314, 24.71264},
			{-1788.77722, 895.90314, 24.71264},
			{-1788.77722, 899.90314, 24.71264},
			{-1788.77722, 903.90314, 24.71264},
		},
		[14] = {
			{-1904.80261, 903.95062, 34.98619},
			{-1904.80261, 899.95062, 34.98619},
			{-1904.80261, 895.95062, 34.98619},
			{-1904.80261, 891.95062, 34.98619},
			{-1904.80261, 887.95062, 34.98619},
			{-1904.80261, 883.95062, 34.98619},
			{-1904.80261, 879.95062, 34.98619},
			{-1904.80261, 875.95062, 34.98619},
			{-1904.80261, 871.95062, 34.98619},
			{-1904.80261, 867.95062, 34.98619},
			{-1904.80261, 863.95062, 34.98619},
		},
		[15] = {
			{-1893.55273, 863.95062, 34.9861},
			{-1893.55273, 867.95062, 34.9861},
			{-1893.55273, 871.95062, 34.9861},
			{-1893.55273, 875.95062, 34.9861},
			{-1893.55273, 879.95062, 34.9861},
			{-1893.55273, 883.95062, 34.9861},
			{-1893.55273, 887.95062, 34.9861},
			{-1893.55273, 891.95062, 34.9861},
			{-1893.55273, 895.95062, 34.9861},
			{-1893.55273, 899.95062, 34.9861},
			{-1893.55273, 903.95062, 34.9861},
		},
		[16] = {
			{-1893.98730, 945.99243, 34.98621},
			{-1893.45642, 950.66864, 34.99261},
			{-1892.93298, 955.23145, 34.99376},
			{-1892.16663, 959.20813, 34.99403},
			{-1891.28943, 963.52863, 34.99397},
			{-1890.59241, 967.45782, 34.99270},
			{-1889.94910, 971.78986, 34.99268},
			{-1889.25452, 976.19702, 34.99236},
			{-1888.39905, 980.87866, 34.99269},
			{-1887.47461, 985.46002, 34.99281},
			{-1886.48828, 989.65033, 35.34623},
			{-1885.63867, 993.81720, 36.05567},
			{-1884.92908, 997.89471, 36.75469},
			{-1884.13416, 1002.09961, 37.47542},
			{-1883.37646, 1006.46710, 38.22404},
			{-1882.71667, 1010.46759, 39.04825},
			{-1882.10266, 1014.40588, 39.87362},
			{-1881.44104, 1018.86774, 40.80846},
			{-1880.86279, 1022.95154, 41.66461},
			{-1880.39746, 1027.96350, 42.69383},
			{-1879.92505, 1032.21594, 43.56069},
			{-1879.35767, 1037.58496, 44.65499},
			{-1878.87524, 1042.68054, 45.25968},
			{-1878.59277, 1047.60498, 45.26745},
			{-1878.71631, 1052.63208, 45.26729},
			{-1878.78467, 1056.55164, 45.26744},
			{-1878.87109, 1061.48022, 45.26733},
			{-1878.94531, 1065.80432, 45.26731},
			{-1879.03040, 1070.31836, 45.26743},
			{-1879.12231, 1075.20923, 45.26740},
			{-1879.19592, 1079.11267, 45.26743},
			{-1879.25134, 1083.64587, 45.26746},
			{-1879.24780, 1089.08264, 45.26749},
		},
	}
}

local markers = {}
local blip

function losujLokacje()
	local r = math.random(1, #punkty[1])
	
	if trasa == r then
		losujLokacje(region)
		return
	end
	
	trasa = r
	punkt = 1
	
	createPunkty(punkty[1][r])
end
addEvent("sweeperki:losujLokacje", true)
addEventHandler("sweeperki:losujLokacje", getRootElement(), losujLokacje)

function createPunkty(tab)
	if isElement(markers[1]) then return end
	for i,v in ipairs(tab) do
		if i == 1 then
			blip = createBlip(v[1], v[2], v[3], 41)
		end
		local hpkt = #punkty[region][trasa]
		local p = i/hpkt
		r,g,b = interpolateBetween(255, 0, 0, 0, 255, 0, p, "Linear")
		
		markers[i] = createMarker(v[1], v[2], v[3], "ring", 1.5, r, g, b, 50)
		if i < #punkty[region][trasa] then
			x,y,z = punkty[region][trasa][i+1][1], punkty[region][trasa][i+1][2], punkty[region][trasa][i+1][3]
		else
			x,y,z = punkty[region][trasa][i-1][1], punkty[region][trasa][i-1][2], punkty[region][trasa][i-1][3]
		end
		setElementData(markers[i], "i", i)
		setMarkerTarget(markers[i], x, y, z)
		
		addEventHandler("onClientMarkerHit", markers[i], zaliczPunkt)
	end
end

addEventHandler("onClientResourceStart", resourceRoot, function ()
	--trasa = 16
	--createPunkty(punkty[region][trasa])
end)

function destroyPunkty()
	for i,v in ipairs(markers) do
		if isElement(v) then
			destroyElement(v)
		end
	end
	if isElement(blip) then
		destroyElement(blip)
	end
end
addEvent("sweeperki:destroyPunkty", true)
addEventHandler("sweeperki:destroyPunkty", getRootElement(), destroyPunkty)

function zaliczPunkt(hit)
	if not isPedInVehicle(hit) then return end
	if getVehicleModel(getPedOccupiedVehicle(hit)) ~= 574 then return end
	local i = getElementData(source, "i")
	if i == punkt then
		if i == #punkty[1][trasa] then
			punkt = 1
			local zarobek = math.floor((#punkty[region][trasa])*perpunkt)
			exports.rpg_noti:createNotification("info", "Sprzątanie zakończone. Zarobiłeś $"..zarobek)
			
			local money = getElementData(localPlayer, "user:jobmoney") or 0
			setElementData(localPlayer, "user:jobmoney", money+zarobek)
			destroyPunkty()
			losujLokacje(region)
		else
			if i == 1 then
				destroyElement(blip)
				local m = #punkty[region][trasa]
				blip = createBlip(punkty[region][trasa][m][1], punkty[region][trasa][m][2], punkty[region][trasa][m][3], 41)
			end
			punkt = punkt + 1
		end
	else
		exports.rpg_noti:createNotification("error", "Pominąłeś jeden lub więcej punktów. Udaj się do następnej lokacji!")
		destroyPunkty()
		losujLokacje(region)
	end
end

setElementData(localPlayer, "job:veh", false)

fileDelete("sweeperki_client.lua")